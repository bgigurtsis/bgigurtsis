---
layout:     post
title:      Making a Discord bot
date:       2021-02-15 23:39:00
summary:    Python discord bot that reacts to my a specific user's messages
categories: coding
---
I had the idea to make a simple discord bot that would react to a user's messages. The bot uses [discord.py](https://discordpy.readthedocs.io/en/latest/index.html), a Discord API wrapper built in python. It is designed to react if, and only if, a specific user sends either a link or uploads an image.

A 'reaction' on discord is that little image under the message, nothing too intrusive:

![](https://www.bgigurtsis.com/pictures/posts/discordbot/1.png)

Here's the code for my bot:

{% highlight python %}
# bot.py
import os
import re
import discord

from dotenv import load_dotenv

load_dotenv()

client = discord.Client()

@client.event
# function to check for regex matching a url
async def on_message(message):

    emoji = '<:timeout2:806320653451001856>'

    regex = re.compile('((http|https)\:\/\/)?[a-zA-Z0-9\.\/\?\:@\-_=#]+\.([a-zA-Z]){2,6}([a-zA-Z0-9\.\&\/\?\:@\-_=#])*')
    match = regex.search(message.content)#

    if message.author.bot:
        return
    elif message.author.id == 389104618099048468:
        if match or message.attachments:
            await message.add_reaction(emoji)

client.run(os.getenv('TOKEN'))
{% endhighlight %}

I'll take you through the code bit by bit, explaining what each part does.

{% highlight python %}
load_dotenv()
{% endhighlight %}

This calls `load_dotenv`, loading environment variables from a file called `.env` in the current directory. My `.env` file holds the OAuth2 token that allows the bot to connect with my Discord developer account.

It's important to put `.env` inside `.gitignore` if publishing the code to GitHub as anyone with this token could place their bot in my Discord server with admin privileges. I did this accidentally. Luckily for me, Discord has a bot that crawls GitHub, cancels your token and alerts you if you upload your token there by accident. Thanks, Discord!

{% highlight python %}
client = discord.Client()

@client.event
{% endhighlight %}

Create an instance of `client`, our connection to Discord. The second line tells python that an event needs to happen to execute.

{% highlight python %}
async def on_message(message):
{% endhighlight %}

Runs the following code when a message is received.

{% highlight python %}
emoji = '<:timeout2:806320653451001856>'
{% endhighlight %}

I want the bot to react to messages with a specific emoji. Here I define which emoji and ID of that emoji.

{% highlight python %}
regex = re.compile('((http|https)\:\/\/)?[a-zA-Z0-9\.\/\?\:@\-_=#]+\.([a-zA-Z]){2,6}([a-zA-Z0-9\.\&\/\?\:@\-_=#])*')
match = regex.search(message.content)#
{% endhighlight %}

These two lines of code are how the bot detects links in a specific message. I define some regex will only match to a link and pass this as a function `match`.

{% highlight python %}
if message.author.bot:
    return
elif message.author.id == 389104618099048468:
    if match or message.attachments:
        await message.add_reaction(emoji)
{% endhighlight %}

This block first checks if the message received is from any bot. If so it returns and waits for another message.

Otherwise, it checks for a specific user ID that I define. Then if it that message either match's the regex (is a link) or if the message contains an attachment the bot reacts to that message.---
layout:     post
title:      Automating my job search   
date:       2021-02-13 23:39:00
summary:    Here's how I automated my job search with CrunchBase and Hunter.io
categories: job
---

The first step was to find a list of emails for companies I wanted to apply to. CrunchBase is great for this. With a free trial, they allow you to search for a list of companies against filters like date founded, number of employees etc.

![](https://www.bgigurtsis.com/pictures/posts/jobs/crunchbase1.png)

Unfortunately, that's where the free trial ends. To export your now filtered list, you need to "upgrade" your free trial and pay about Â£250. No thanks. To get around this I first highlighted all the companies whose emails I wanted and copied that information into notepad. At first, I tried MS Word but discovered that notepad is significantly faster for processing large amounts of text.

![](https://www.bgigurtsis.com/pictures/posts/jobs/crunchbase2.png)

![](https://www.bgigurtsis.com/pictures/posts/jobs/emails1.png)

All the text is raw and so I needed a way to filter out only the emails. After some googling, I came across this script on [github](https://gist.github.com/dideler/5219706).

{% highlight python %}
from optparse import OptionParser
import os.path
import re

regex = re.compile(("([a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`"
                    "{|}~-]+)*(@|\sat\s)(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?(\.|"
                    "\sdot\s))+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)"))

def file_to_str(filename):
    """Returns the contents of filename as a string."""
    with open(filename) as f:
        return f.read().lower() # Case is lowered to prevent regex mismatches.

def get_emails(s):
    """Returns an iterator of matched emails found in string s."""
    # Removing lines that start with '//' because the regular expression
    # mistakenly matches patterns like 'http://foo@bar.com' as '//foo@bar.com'.
    return (email[0] for email in re.findall(regex, s) if not email[0].startswith('//'))

if __name__ == '__main__':
    parser = OptionParser(usage="Usage: python %prog [FILE]...")
    # No options added yet. Add them here if you ever need them.
    options, args = parser.parse_args()

    if not args:
        parser.print_usage()
        exit(1)

    for arg in args:
        if os.path.isfile(arg):
            for email in get_emails(file_to_str(arg)):
                print(email)
        else:
            print('"{}" is not a file.'.format(arg))
            parser.print_usage()`
{% endhighlight %}

This script very neatly pulled out all of the emails.

![](https://www.bgigurtsis.com/pictures/posts/jobs/powershell.jpg)

Next up is verifying that those emails work. [Hunter.io](http://www.hunter.io) is the perfect tool for this. I copied the emails into their bulk verifier and let them do the work.

Once I got the list of verified emails the last step is to send out a campaign using those emails. Hunter.io provides this functionality too.

![](https://www.bgigurtsis.com/pictures/posts/jobs/hunter2.png)

This is as far as I've got. When my email campaign is completed I'll be sure to update this post.


{% highlight python %}
client.run(os.getenv('TOKEN'))
{% endhighlight %}

Finally, this code takes the OAuth2 token and passes it to the bot.

Further information and documentation for discord.py can be found [here](https://discordpy.readthedocs.io/en/latest/index.html).
